# 推荐服务配置教程

本教程详细说明如何配置和管理 Claude Code Router 的推荐服务页面。

## 📋 目录

- [快速开始](#快速开始)
- [配置文件位置](#配置文件位置)
- [完整字段说明](#完整字段说明)
- [配置示例](#配置示例)
- [操作指南](#操作指南)
- [字段详解](#字段详解)
- [常见问题](#常见问题)
- [最佳实践](#最佳实践)

---

## 🚀 快速开始

### 第一步：找到配置文件

配置文件位于项目根目录：
```
claude-code-router/
└── config/
    └── providers.json
```

### 第二步：编辑配置

使用任何文本编辑器打开 `config/providers.json`，按照格式添加或修改服务商信息。

### 第三步：刷新页面

在应用的"推荐服务"页面点击右上角的 **刷新** 按钮，即可看到最新的配置。

---

## 📁 配置文件位置

```
项目根目录/config/providers.json
```

**重要提示**:
- ✅ 使用根目录的 `config/providers.json`
- ❌ 不要修改 `src-tauri` 内的任何文件
- 📝 建议先备份原文件再修改

---

## 📖 完整字段说明

### 文件结构

```json
{
  "version": "1.0",
  "description": "配置文件描述（可选）",
  "providers": [
    {
      // 服务商配置...
    }
  ]
}
```

### 服务商配置字段

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `id` | String | ✅ | 唯一标识符（小写+短横线） | `"claude-api-pro"` |
| `name` | String | ✅ | 显示名称 | `"Claude API Pro"` |
| `category` | String | ✅ | 服务商分类 | `"aggregator"` |
| `websiteUrl` | String | ✅ | 官网地址（推广链接） | `"https://example.com"` |
| `serverUrl` | String | ✅ | API 服务器地址 | `"https://api.example.com"` |
| `description` | String | ❌ | 服务商简介（推荐填写） | `"国内领先的..."` |
| `showInRecommendations` | Boolean | ❌ | 是否在推荐页显示（默认 true） | `true` |
| `isRecommended` | Boolean | ❌ | 是否推荐（默认 false） | `true` |
| `isPartner` | Boolean | ❌ | 是否合作伙伴（默认 false） | `false` |
| `hotnessScore` | Number | ❌ | 热度评分 0-100（默认 0） | `95` |
| `region` | String | ❌ | 服务区域（默认 domestic） | `"domestic"` |
| `apiKeyUrl` | String | ❌ | API Key 获取地址 | `"https://example.com/api"` |
| `defaultModel` | String | ❌ | 默认模型 | `"claude-sonnet-4-5"` |
| `haikuModel` | String | ❌ | Haiku 模型 | `"claude-haiku-4-5"` |
| `sonnetModel` | String | ❌ | Sonnet 模型 | `"claude-sonnet-4-5"` |
| `opusModel` | String | ❌ | Opus 模型 | `"claude-opus-4"` |
| `smallFastModel` | String | ❌ | 小型快速模型 | `"claude-haiku-4-5"` |
| `apiTimeoutMs` | Number | ❌ | API 超时（毫秒） | `600000` |
| `maxOutputTokens` | Number | ❌ | 最大输出令牌数 | `65000` |
| `endpointCandidates` | Array | ❌ | 备选端点列表 | `[]` |

---

## 💡 配置示例

### 示例 1：基础推荐服务配置

```json
{
  "id": "my-claude-api",
  "name": "我的 Claude API",
  "category": "third_party",
  "websiteUrl": "https://my-api.com",
  "serverUrl": "https://api.my-api.com",
  "description": "高质量的 Claude API 中转服务，稳定可靠，价格实惠",
  "showInRecommendations": true,
  "isRecommended": true,
  "isPartner": false,
  "hotnessScore": 88,
  "region": "domestic"
}
```

### 示例 2：国外服务配置

```json
{
  "id": "international-api",
  "name": "International API Service",
  "category": "aggregator",
  "websiteUrl": "https://intl-api.com",
  "serverUrl": "https://api.intl-api.com",
  "description": "海外优质 API 网关服务，低延迟高可用",
  "showInRecommendations": true,
  "isRecommended": true,
  "isPartner": false,
  "hotnessScore": 90,
  "region": "international"
}
```

### 示例 3：完整配置（含模型信息）

```json
{
  "id": "premium-claude",
  "name": "Premium Claude Service",
  "category": "aggregator",
  "websiteUrl": "https://premium.com",
  "apiKeyUrl": "https://premium.com/api-keys",
  "serverUrl": "https://api.premium.com",
  "description": "企业级 Claude API 服务，提供完整的模型支持和技术保障",
  "showInRecommendations": true,
  "isRecommended": true,
  "isPartner": true,
  "hotnessScore": 95,
  "region": "domestic",
  "defaultModel": "claude-sonnet-4-5-20250929",
  "haikuModel": "claude-haiku-4-5-20251001",
  "sonnetModel": "claude-sonnet-4-5-20250929",
  "opusModel": "claude-opus-4-20250514",
  "smallFastModel": "claude-haiku-4-5-20251001",
  "apiTimeoutMs": 600000,
  "maxOutputTokens": 65000,
  "endpointCandidates": [
    "https://api.premium.com",
    "https://backup.premium.com"
  ]
}
```

---

## 🛠 操作指南

### 添加新的推荐服务

**步骤：**

1. 打开 `config/providers.json`
2. 在 `providers` 数组中添加新的服务商对象
3. 确保 `id` 字段唯一
4. 填写必填字段（id, name, category, websiteUrl, serverUrl）
5. 根据需要填写可选字段
6. 保存文件
7. 在应用中点击"刷新"按钮

**示例：**

```json
{
  "version": "1.0",
  "providers": [
    // ... 现有服务商 ...
    ,
    {
      "id": "new-service",
      "name": "新服务",
      "category": "third_party",
      "websiteUrl": "https://new-service.com",
      "serverUrl": "https://api.new-service.com",
      "description": "这是一个新的服务商",
      "isRecommended": true,
      "hotnessScore": 85,
      "region": "domestic"
    }
  ]
}
```

### 修改现有服务

**步骤：**

1. 找到要修改的服务商（通过 `id` 字段定位）
2. 修改需要更新的字段
3. 保存文件
4. 刷新应用

**常见修改：**

```json
// 更新热度评分
"hotnessScore": 92  // 从 88 改为 92

// 更新推荐状态
"isRecommended": true  // 设为推荐

// 更新简介
"description": "更新后的服务商简介信息"

// 更新区域
"region": "international"  // 改为国外服务
```

### 删除服务

**步骤：**

1. 找到要删除的服务商对象
2. 删除整个对象（包括花括号）
3. 注意处理逗号：
   - 如果删除的是最后一项，删除前一项的逗号
   - 如果删除的不是最后一项，保留逗号
4. 保存文件
5. 刷新应用

**示例：**

```json
// 删除前
{
  "providers": [
    { "id": "service-1", ... },
    { "id": "service-2", ... },  // 要删除这个
    { "id": "service-3", ... }
  ]
}

// 删除后
{
  "providers": [
    { "id": "service-1", ... },
    { "id": "service-3", ... }
  ]
}
```

### 调整服务排序

推荐服务的排序由 **热度评分** (`hotnessScore`) 决定：

- 热度越高，排序越靠前
- 相同热度按添加顺序排列

**调整步骤：**

1. 修改 `hotnessScore` 字段
2. 保存文件
3. 刷新应用

**示例：**

```json
// 让 service-A 排在 service-B 前面
{
  "id": "service-a",
  "hotnessScore": 95  // 设置更高的分数
},
{
  "id": "service-b",
  "hotnessScore": 88
}
```

---

## 🔍 字段详解

### category（服务商分类）

决定服务商在配置管理页面的分类显示：

| 值 | 说明 | 示例 |
|----|------|------|
| `official` | 官方服务 | Claude Official |
| `cn_official` | 国产官方 | DeepSeek, GLM, Qwen |
| `aggregator` | 聚合平台 | AiHubMix |
| `third_party` | 第三方供应商 | PackyCode |
| `custom` | 自定义 | 用户自建服务 |

### region（服务区域）

在推荐服务卡片上显示地区标签：

| 值 | 显示 | 颜色 | 适用场景 |
|----|------|------|----------|
| `domestic` | 国内 | 绿色 | 国内可直连的服务 |
| `international` | 国外 | 蓝色 | 需要特殊网络的服务 |

**选择建议：**
- 国内可直接访问 → `domestic`
- 需要科学上网 → `international`

### showInRecommendations（推荐页显示控制）

控制服务商是否出现在"推荐服务"页面：

```json
"showInRecommendations": true   // 在推荐页面显示此服务（默认）
"showInRecommendations": false  // 不在推荐页面显示（仅配置管理可见）
```

**适用场景：**
- `true`: 面向用户的推荐服务（大多数情况）
- `false`:
  - 内部测试服务
  - 已停止服务的供应商
  - 仅供配置管理使用的服务
  - 不希望对外展示的服务

**注意：** 设置为 `false` 后，该服务仍然可以在"配置管理"页面正常使用，只是不会出现在"推荐服务"页面。

### isRecommended（推荐状态）

控制是否显示"推荐"角标：

```json
"isRecommended": true   // 显示黄色"推荐"角标
"isRecommended": false  // 不显示角标
```

**建议使用场景：**
- 服务稳定性高
- 用户评价好
- 性价比优秀
- 合作伙伴服务

### hotnessScore（热度评分）

- **范围**: 0-100
- **作用**: 决定排序位置（数值越大越靠前）
- **不显示**: 该数值不会在界面上显示给用户

**评分参考：**

| 分数范围 | 推荐场景 |
|----------|----------|
| 90-100 | 顶级服务，强烈推荐 |
| 75-89 | 优质服务，推荐使用 |
| 60-74 | 良好服务，可选择 |
| 50-59 | 一般服务 |
| 0-49 | 较少推荐 |

### description（服务商简介）

- **长度建议**: 30-100 个中文字符
- **显示位置**: 服务卡片中部
- **显示行数**: 最多 3 行（超出显示省略号）

**撰写建议：**
1. 突出服务特点（稳定、快速、便宜等）
2. 说明适用场景（个人、团队、企业）
3. 提及技术支持或售后服务
4. 避免过度营销用语

**示例：**

✅ 好的简介：
```
"国内领先的 Claude API 服务商，提供稳定高速的API接口，7x24小时技术支持，企业级服务保障"
```

❌ 不好的简介：
```
"最好的服务！！！超级便宜！！！"  // 过度营销
```

### endpointCandidates（备选端点）

用于故障切换和负载均衡：

```json
"endpointCandidates": [
  "https://api.example.com",      // 主端点
  "https://backup.example.com",   // 备用端点 1
  "https://api2.example.com"      // 备用端点 2
]
```

**用途：**
- 主服务器不可用时自动切换
- 用户可在配置管理页面选择端点
- 提高服务可用性

---

## ❓ 常见问题

### Q1: 修改配置后不生效？

**解决方案：**
1. 确保 JSON 格式正确（可使用在线 JSON 验证工具）
2. 在应用中点击"刷新"按钮
3. 如果仍不生效，重启应用

### Q2: JSON 格式错误怎么办？

**常见错误：**

❌ 缺少逗号：
```json
{
  "id": "test"
  "name": "Test"  // 错误：前一行末尾缺少逗号
}
```

✅ 正确：
```json
{
  "id": "test",
  "name": "Test"
}
```

❌ 多余的逗号：
```json
{
  "providers": [
    { "id": "test" },  // 最后一项不应有逗号
  ]
}
```

✅ 正确：
```json
{
  "providers": [
    { "id": "test" }
  ]
}
```

**验证工具：**
- 在线验证：[JSONLint](https://jsonlint.com/)
- VS Code 自动检查
- 编辑器插件

### Q3: id 冲突怎么办？

如果两个服务商的 `id` 相同，系统会出现异常。

**解决方案：**
- 确保每个服务商的 `id` 唯一
- 使用小写字母和短横线命名（如 `my-service-1`）
- 建议命名规则：`公司名-产品名`

### Q4: 推荐服务不显示？

**检查清单：**
- [ ] `isRecommended` 是否为 `true`
- [ ] JSON 格式是否正确
- [ ] 是否点击了刷新按钮
- [ ] 必填字段是否完整

### Q5: 如何让某个服务排在最前面？

**方法：**
将该服务的 `hotnessScore` 设为最高值（如 100）：

```json
{
  "id": "top-service",
  "name": "置顶服务",
  "hotnessScore": 100,
  // ... 其他配置
}
```

### Q6: 可以添加自己的服务商吗？

**可以！** 这正是配置文件的设计目的。

**步骤：**
1. 按照格式添加新的服务商
2. 设置合适的分类（建议用 `custom`）
3. 填写真实的 URL 和说明
4. 保存并刷新

---

## ✨ 最佳实践

### 1. 备份原文件

修改前先备份：
```bash
cp config/providers.json config/providers.json.backup
```

### 2. 使用版本控制

如果项目使用 Git：
```bash
git add config/providers.json
git commit -m "更新推荐服务配置"
```

### 3. 分类合理

根据实际情况选择正确的 `category`：
- 官方服务用 `official` 或 `cn_official`
- 聚合平台用 `aggregator`
- 个人/小型服务用 `third_party`
- 测试/临时用 `custom`

### 4. 热度评分合理

建议评分范围：
- 顶级推荐：90-95
- 一般推荐：75-89
- 普通服务：60-74
- 不太推荐：50-59

### 5. 简介精炼

- 控制在 30-80 个中文字符
- 突出 2-3 个核心优势
- 避免过度营销
- 客观描述服务特点

### 6. 定期维护

- 定期检查服务是否可用
- 更新不准确的描述
- 删除已下线的服务
- 调整热度评分

### 7. 测试验证

添加新服务后：
1. 检查 JSON 格式
2. 刷新页面查看效果
3. 点击访问链接测试
4. 检查卡片显示是否正常

---

## 📝 配置模板

### 复制此模板快速添加服务

```json
{
  "id": "your-service-id",
  "name": "您的服务名称",
  "category": "third_party",
  "websiteUrl": "https://your-website.com",
  "serverUrl": "https://api.your-service.com",
  "description": "服务商简介，控制在 30-80 个字符",
  "isRecommended": true,
  "isPartner": false,
  "hotnessScore": 80,
  "region": "domestic",
  "endpointCandidates": []
}
```

---

## 🆘 获取帮助

如果遇到问题：

1. **检查日志**: 查看应用日志获取错误信息
2. **验证 JSON**: 使用 JSONLint 等工具验证格式
3. **查看示例**: 参考现有配置的格式
4. **恢复备份**: 如果改错了，恢复备份文件

---

## 📚 相关文档

- [config/README.md](config/README.md) - 配置文件详细说明
- [config/providers.json](config/providers.json) - 实际配置文件

---

**最后更新**: 2025-11-11
**版本**: v1.0
